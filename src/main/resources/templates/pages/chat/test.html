<!doctype html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{common/layout/defaultLayout}"
      layout:fragment="Content">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        .chatRoomTop{
            font-size: 0.8em;
        }
        h2{
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #000000;
            font-family: 'GmarketSansMedium', serif;
            font-weight: bold;
            border-bottom: 2px solid #D54946;
        }
        /* card형 기본 스타일 */
        .chatRoom-list {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            width: 100%;
            /*height: 100%;*/
        }

        .card-item {
            width: 224px;
            height: 300px;
            background-color: #ffe5b4;
            border-radius: 20px;
            position: relative;
        }

        .card-mouseover {
            user-select: none;
            width: 100%;
            height: 100%;
            border-radius: 20px;
            z-index: 4;
            background-color: black;
            opacity: 0;
            position: absolute;
            top: 0;
            left: 0;
            /*padding-top: 50px;*/
        }

        .card-mouseover.visible {
            transition: all 200ms;
            opacity: 0.7;
        }
        .card-mouseover-text {
            text-align: center;
            color: white;
            font-size: 15px;
            margin-top: 40px;
        }
        .card-mouseover-text.joinBtn {
            margin: 20px auto;
            width: 80px;
            height: 50px;
            border-radius: 10px;
            border: 1px solid white;
            text-align: center;
            line-height: 50px;
            cursor: pointer;
            transition: all 200ms;
        }
        .card-mouseover-text.joinBtn:hover {
            background-color: white;
            color: black;
        }
        .card-report-btn{
            position: absolute;
            right: 10px;
            bottom:120px;
            color: white;
        }
        .report-btn:hover{
            color: #EA4E4A;
            font-weight: bold;
            user-select: none;
            cursor: pointer;
        }

        .toCard-item-info {
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            padding: 10px;
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 40%;
            background-color: rgba(0, 0, 0, 0.62);
            color: white;
            border-radius: 20px;
            transition: all 300ms;
            z-index: 5;
        }
        .toCard-item-info:hover {
            height: 100%;
        }
        .itemCard-title, .itemCard-recentContent, .itemCard-roomDate {
            display: none;
        }
        .itemCard-recentContent{
            height: 80px;
        }

    </style>
</head>
<body>
    <section class="chatRoomTop">
        <h2>시끌벅적 TOP 5</h2>
        <div class="chatRoom-list">
            <div th:if="${chatRoomList != null}" th:each="chatRoom : ${chatRoomList}" class="chatRoom-item card-item">
                <div class="card-mouseover">
                    <div class="card-mouseover-text" th:if="${chatRoom.roomCategory == 'reservation'}" th:text="'모집방'"></div>
                    <div class="card-mouseover-text" th:if="${chatRoom.roomCategory == 'talk'}" th:text="'소통방'"></div>
                    <div class="card-mouseover-text joinBtn" th:onclick="joinChatRoom([[${chatRoom.roomNo}]],[[${chatRoom.roomWriter}]],[[${chatRoom.movieNo}]],[[${chatRoom.title}]], [[${chatRoom.posterUrl}]], [[${chatRoom.cinemaNo}]],[[${chatRoom.cinemaName}]], [[${chatRoom.cinemaLocationCode}]], [[${chatRoom.cinemaAddress}]], [[${chatRoom.roomCategory}]]);">참여하기</div>
                    <div class="report-btn card-report-btn">신고</div>
                </div>
                <div th:style="'width:100%; height: 300px; background-image: url('+${chatRoom.posterUrl}+'); background-position: center; background-size: cover; border-radius:20px;'">
                </div>

                <div class="toCard-item-info">
                    <div class="itemCard-title" th:text="'< '+${chatRoom.title}+' >'"></div>
                    <div style="font-size: 20px; font-weight:bold" th:text="${#strings.length(chatRoom.roomName) > 15 ? chatRoom.roomName.substring(0, 15) + ' . . .' : chatRoom.roomName}"></div>

                    <th:block th:if="${chatRoom.recentContent == null}">
                        <div class="itemCard-recentContent" th:text="'아직 대화한 내용이 없습니다'"></div>
                    </th:block>
                    <th:block th:if="${chatRoom.recentContent != null}">
                        <div class="itemCard-recentContent" th:text="${chatRoom.recentContent}"></div>
                    </th:block>

                    <div>
                        <span th:each="tag : ${tagList}" th:if="${tag.roomNo == chatRoom.roomNo}" th:text="'#'+${tag.tagName}+' '"></span>
                    </div>
                    <th:block th:if="${chatRoom.joinCount == null}">
                        <div style="" th:text="'1명 참여중'"></div>
                    </th:block>
                    <th:block th:if="${chatRoom.joinCount != null}">
                        <div style="" th:text="${chatRoom.joinCount}+'명 참여중'"></div>
                    </th:block>

                    <div th:text="${chatRoom.cinemaAddress}+' / '+${chatRoom.cinemaName}"></div>
                    <th:block th:each="rTime : ${relativeTimeList}">
                        <div class="itemCard-roomDate" th:if="${chatRoom.roomDate == rTime.roomDate}" th:text="'개설일 : '+${rTime.relativeTime}"></div>
                    </th:block>

                </div>
            </div>
        </div>
    </section>
    <script>
        // 카드형 리스트 채팅방 정보
        const roomCardInfos = document.querySelectorAll('.toCard-item-info');
        roomCardInfos.forEach((item,index) => {
            item.addEventListener('mouseover',()=>{
                let itemCardTitles = document.querySelectorAll('.itemCard-title');
                let itemCardRecentContents = document.querySelectorAll('.itemCard-recentContent');
                let itemCardRoomDates = document.querySelectorAll('.itemCard-roomDate');


                itemCardTitles[index].style.display="block";
                itemCardRecentContents[index].style.display="block";
                itemCardRoomDates[index].style.display="block";


                item.addEventListener('mouseout',()=>{
                    itemCardTitles[index].style.display="none";
                    itemCardRecentContents[index].style.display="none";
                    itemCardRoomDates[index].style.display="none";

                });
            });

        })

        let cardMouseover = document.querySelectorAll('.card-mouseover');
        cardMouseover.forEach(item=>{

            item.addEventListener('mouseover',()=>{
                item.classList.add('visible');
                console.log("hi")
                item.addEventListener('mouseout',()=>{
                    item.classList.remove('visible');
                    item.classList.remove('visible');
                    item.classList.remove('visible');

                });
            })

        })
    </script>
</body>
</html>