<!DOCTYPE html>
    <!-- Default Layout Import-->
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{common/layout/defaultLayout}"
      layout:fragment="Content">
    <head>
        <title>채팅방 목록</title>
        <script src="https://kit.fontawesome.com/7d4169cb69.js" crossorigin="anonymous"></script>
        <!-- inline CSS 영역-->
        <style th:inline="css" type="text/css">

            *{
                font-family: 'NEXON Lv1 Gothic OTF', serif;
            }
            /* 페이징 처리 */
            .paginationBox a{
                display:inline-block;
                text-align:center;
                line-height:30px;
                font-size: 20px;
                min-width:30px;
                height:30px;
                text-decoration: none;
                color: #6e6e6e;
            }
            .paginationBox #currentPageId{
                display:inline-block;
                text-align:center;
                line-height:30px;
                font-size: 20px;
                min-width:30px;
                height:30px;
                text-decoration: none;
                border-radius:50%;
                background-color:#EA4E4A;
                color: white;
            }

            .paginationBox{
                text-align: center;
                height: 120px;
                line-height: 100px;
            }

            .chatRoomList-main{
                width: 100%;
            }

            /*list, card 기준이 되는 relative 컨테이너*/
            #position-box{
                position: relative;
                width: 100%;
                height: 1600px;
                overflow: hidden;
            }

            /* 검색, 내 채팅방, 전체 메뉴 버튼*/
            .listMenuContainer{
                margin: 0 auto;
                display: flex;
                width: 90%;
                height: 50px;
                font-size: 20px;
            }
            .listMenu-item{
                user-select: none;
                width: 120px;
                height: 100%;
                text-align: center;
                line-height: 50px;
                background-color: #ececec;
                border-radius: 100px;
                transition: all 200ms;
                margin: 5px;
                cursor:pointer;

            }
            .listMenu-item:hover{
                background-color: #466288;
                color: white;
                transform: scale(1.02);
            }


            /* list 전환 버튼 css */
            #listSwitchContainer{
                display: flex;
                justify-content: right;
                width: 100%;
                height: 45px;
                align-items: center;
                text-align: center;
                line-height: 45px;
            }

            .listSwitch-btn{
                width: 110px;
                height: 100%;
                background-color: #ececec;
                font-size: 18px;
                border: none;
                border-radius: 10px;
                transition: all 200ms;
                cursor: pointer;
                margin-right: 20px;
            }
            .listSwitch-btn span{
                display: inline-block;
                margin-left: 10px;
            }
            .listSwitch-btn:hover{
                transform:scale(1.05);
                color: white;
                font-size: 20px;
                font-weight: bold;
                background-color: #EA4E4A;
            }

            #toCard-btn.active, #toList-btn.active{
                transform:scale(1.05);
                color: white;
                font-size: 20px;
                font-weight: bold;
                background-color: #EA4E4A;
            }

            /* list형, card형 css */
            #toList-container{
                margin:0 auto;
                position: absolute;
                top:10px;
                left: 0;
                width: 100%;
                height: 100%;
                z-index: 3;
            }
            #toCard-container{
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                gap: 20px;
                position: absolute;
                top:10px;
                left: 0;
                width: 100%;
                z-index: 2;
            }

            /* list형 기본 스타일 */
            .list-item {
                width: 90%;
                height: 150px;
                background-color: white;
                padding: 15px;
                border-radius: 15px;
                /*transition: opacity 0.5s ease, transform 0.5s ease;*/
                opacity: 1;
                /*transform: scale(1);*/
                margin: 0 auto;
                margin-bottom: 20px;

                visibility: visible; /* 처음엔 숨겨져 있음 */
                transform: translateY(20px);
                transition: opacity 0.5s ease, transform 0.5s ease, visibility 0s 0.5s; /* visibility는 0.5초 후에 표시 */
            }
                .list-item.fade-in:hover{
                    transform: translateY(-5px);
                    box-shadow: 0 5px 5px 5px rgb(162, 162, 162);

                }
            /* list형 fade-in 스타일 */
            .list-item.fade-in {
                visibility: visible; /* 0.5초 후에 보이게 */
                opacity: 1;
                transform: translateY(0);
                transition: opacity 0.5s ease, transform 0.5s ease, box-shadow 0.2s; /* 부드럽게 등장 */
            }
            /* list형 fade-out 스타일 */
            .list-item.fade-out {
                opacity: 0;
                transform: scale(0.9);
                visibility: hidden;
            }


            /* card형 기본 스타일 */
            .card-item {
                width: 30%;
                height: 500px;
                background-color: #ffe5b4;
                /*padding: 20px;*/
                border-radius: 20px;

                opacity: 0;
                visibility: hidden; /* 처음엔 숨겨져 있음 */
                transform: translateY(20px);
                transition: opacity 0.5s ease, transform 0.5s ease, visibility 0s 0.5s; /* visibility는 0.5초 후에 표시 */
            }

            /* card형 fade-in 스타일 */
            .card-item.fade-in {
                visibility: visible; /* 0.5초 후에 보이게 */
                opacity: 1;
                transform: translateY(0);
                transition: opacity 0.5s ease, transform 0.5s ease; /* 부드럽게 등장 */
            }
            /* card형 fade-out 스타일 */
            .card-item.fade-out {
                opacity: 0;
                transform: scale(0.9);
            }


            /* list item flex */
            .item-flex-container{
                display: flex;
                justify-content: left;
                width: 100%;
                height: 100%;
                font-size: 20px;
            }

            .flex-item-memberProfile{
                width: 120px;
                height: 120px;
                margin-right: 20px;
            }

            .chatRoomName{
                font-size: 25px;
                /*font-weight: bold;*/
            }

            .chatTagList{
                color: #6e6e6e;
            }

            .flex-item-chatInfoBox{
                display: flex;
                flex-direction: column;
                justify-content: space-between;
            }

            .itemBtnFlexContainer{
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            .joinBtn{
                width: 60px;
                height: 40px;
                background-color:#6e6e6e;
                border-radius: 10px;
                text-align: center;
                line-height: 40px;
                cursor: pointer;
                transition: all 200ms;
            }
            .joinBtn:hover{
                color:white;
                font-weight: bold;
                background: #EA4E4A;
                transform: scale(1.02);
            }




            /* card item */
            .toCard-item-info{
                display: flex;
                flex-direction: column;
                justify-content: space-around;
                padding: 10px;
                position: absolute;
                bottom:0;
                left:0;
                width: 100%;
                height: 30%;
                background-color: #fff8dc;
                border-radius: 20px;
                transition: all 300ms;
                z-index: 5;
            }
            .toCard-item-info:hover{
                height: 70%;
            }

            .itemCard-title, .itemCard-recentContent, .itemCard-roomDate {
                display: none;
            }

            .card-mouseover{
                user-select: none;
                width: 100%;
                height: 80%;
                border-radius: 20px;
                z-index: 3;
                background-color: black;
                opacity: 0;
                position: absolute;
                top: 0;
                left: 0;
                padding-top: 50px;
            }
            .card-mouseover.visible{
                transition: all 200ms;
                opacity: 0.7;
            }

            .card-mouseover-text{
                text-align: center;
                color: white;
                font-size: 20px;
            }

            .card-mouseover-text.joinBtn2{

                margin: 20px auto;
                width: 100px;
                height: 60px;
                border-radius: 10px;
                border: 1px solid white;
                text-align: center;
                line-height: 60px;
                cursor: pointer;
                transition: all 200ms;
            }
            .card-mouseover-text.joinBtn2:hover{
                background-color:white;
                color: black;
            }
        </style>

        <!-- inline JS 영역-->
        <script th:inline="javascript" type="text/javascript">
            // list -> card 전환 function
            function switchToCardView() {
                const listItems = document.querySelectorAll('.list-item');
                const cardItems = document.querySelectorAll('.card-item');
                const listContainer = document.querySelector('#toList-container');
                const toListBtn = document.querySelector('#toList-btn');
                const toCardBtn = document.querySelector('#toCard-btn');

                // 버튼 활성화 시 클래스 추가 (활성화 스타일 적용)
                toListBtn.classList.remove('active');
                toCardBtn.classList.add('active');


                const url = new URL(window.location);
                url.searchParams.set('viewMode', 'card'); // 쿼리스트링의 viewMode 값 변경
                history.pushState(null, '', url); // 페이지 새로고침 없이 URL 변경

                // 전환되는 동안 버튼 비활성화
                if(!cardItems[0].classList.contains('fade-in')){
                    btnDisabled(listItems, cardItems, "paging");
                }

                // 리스트형 아이템 흐려지게
                listItems.forEach((item, index) => {
                    setTimeout(() => {
                        if (item.classList.contains('fade-in')){
                            item.classList.add('fade-out');
                            item.classList.remove('fade-in');
                        }

                    }, index * 100); // 100ms 간격으로 흐려짐
                });

                listContainer.style.zIndex = '1';


                // 카드형 아이템 순차적으로 나타나게
                cardItems.forEach((item, index) => {
                    setTimeout(() => {
                        if (item.classList.contains('fade-out')){
                            item.classList.add('fade-in');
                            item.classList.remove('fade-out');
                        }
                    }, 200 + (index * 150)); // 리스트가 사라진 후 150ms 간격으로 나타남
                });
            }

            // card -> list 전환 function
            function switchToListView() {
                const listItems = document.querySelectorAll('.list-item');
                const cardItems = document.querySelectorAll('.card-item');
                const listContainer = document.querySelector('#toList-container');
                const cardContainer = document.querySelector('#toCard-container');
                const toListBtn = document.querySelector('#toList-btn');
                const toCardBtn = document.querySelector('#toCard-btn');

                // 버튼 활성화 시 클래스 추가 (활성화 스타일 적용)
                toCardBtn.classList.remove('active');
                toListBtn.classList.add('active');

                const url = new URL(window.location);
                url.searchParams.set('viewMode', 'list'); // 쿼리스트링의 viewMode 값 변경
                history.pushState(null, '', url); // 페이지 새로고침 없이 URL 변경

                // 전환되는 동안 버튼 비활성화
                if(!listItems[0].classList.contains('fade-in')){
                    btnDisabled(listItems, cardItems, "paging");
                }

                // card형 아이템 흐려지게
                cardItems.forEach((item, index) => {
                    setTimeout(() => {
                        if (item.classList.contains('fade-in')){
                            item.classList.add('fade-out');
                            item.classList.remove('fade-in');
                        }
                    }, index * 100); // 100ms 간격으로 흐려짐
                });

                cardContainer.style.zIndex = '1';
                listContainer.style.zIndex = '3';


                // list형 아이템 순차적으로 나타나게
                listItems.forEach((item, index) => {
                    setTimeout(() => {
                        if (item.classList.contains('fade-out')) {
                            item.classList.add('fade-in');
                            item.classList.remove('fade-out');
                        }
                    }, 200 + (index * 150)); // 리스트가 사라진 후 150ms 간격으로 나타남
                });



            }

            // 버튼 비활성화
            function btnDisabled(listItems, cardItems, status){
                const listSwitchBtn = document.querySelectorAll('.listSwitch-btn');
                listSwitchBtn.forEach(item=>{
                    item.disabled = true;
                });

                // 애니메이션이 끝난 후 버튼 활성화
                let totalDuration = 0;
                if(status === 'load'){
                    totalDuration = (cardItems.length * 150);
                }else if(status === 'paging'){
                    totalDuration = 500+(cardItems.length * 150);
                }

                setTimeout(() => {
                    listSwitchBtn.forEach(item=>{
                        item.disabled = false;
                    });
                }, totalDuration); // 애니메이션 시간에 맞춰 비활성화 해제
            }



        //    페이지네이션
            function navigatePage(page){
                let toListBtn = document.querySelector('#toList-btn');
                let toCardBtn = document.querySelector('#toCard-btn');

                if(toListBtn.classList.contains('active')){
                    location.href=`/chat/list?cp=${page}&viewMode=list`;
                }else if(toCardBtn.classList.contains('active')){
                    location.href=`/chat/list?cp=${page}&viewMode=card`;
                }else{
                    console.log("location 실패")
                }

            }

           window.addEventListener('load',()=>{
               const listContainer = document.querySelector('#toList-container');
               const cardContainer = document.querySelector('#toCard-container');
               let listItems = document.querySelectorAll('.list-item');
               let cardItems = document.querySelectorAll('.card-item');
               let toListBtn = document.querySelector('#toList-btn');
               let toCardBtn = document.querySelector('#toCard-btn');
               let viewMode = /*[[${viewMode}]]*/;

               if(viewMode === 'list'){
                   cardContainer.style.zIndex = '1';
                   listContainer.style.zIndex = '3';
                   listItems.forEach((item, index)=>{
                       setTimeout(()=>{
                           item.classList.remove('fade-out');
                           item.classList.add('fade-in');
                       }, 200+(index * 100))

                       if(!toListBtn.classList.contains('active')){
                           toCardBtn.classList.remove('active');
                           toListBtn.classList.add('active');
                       }


                   });

               }else if(viewMode === 'card'){
                   listContainer.style.zIndex = '1';
                   cardItems.forEach((item, index)=>{
                       setTimeout(()=>{
                           item.classList.remove('fade-out');
                           item.classList.add('fade-in');
                       }, 200+(index * 100))

                   if(!toCardBtn.classList.contains('active')){
                       toCardBtn.classList.add('active');
                       toListBtn.classList.remove('active');
                       }
                   });
               }

               // 로드되는 동안 버튼 비활성화
               btnDisabled(listItems, cardItems, "load");



               // 카드형 리스트 채팅방 정보
               const roomCardInfos = document.querySelectorAll('.toCard-item-info');
               roomCardInfos.forEach((item,index) => {
                   item.addEventListener('mouseover',()=>{
                       let itemCardTitles = document.querySelectorAll('.itemCard-title');
                       let itemCardRecentContents = document.querySelectorAll('.itemCard-recentContent');
                       let itemCardRoomDates = document.querySelectorAll('.itemCard-roomDate');


                           itemCardTitles[index].style.display="block";
                           itemCardRecentContents[index].style.display="block";
                           itemCardRoomDates[index].style.display="block";


                       item.addEventListener('mouseout',()=>{
                               itemCardTitles[index].style.display="none";
                               itemCardRecentContents[index].style.display="none";
                               itemCardRoomDates[index].style.display="none";

                       });
                   });

               })

               let cardMouseover = document.querySelectorAll('.card-mouseover');
               cardMouseover.forEach(item=>{

                   item.addEventListener('mouseover',()=>{
                       item.classList.add('visible');
                        console.log("hi")
                       item.addEventListener('mouseout',()=>{
                           item.classList.remove('visible');
                           item.classList.remove('visible');
                           item.classList.remove('visible');

                       });
                   })

               })


           });




        </script>
    </head>

    <body>
        <h1>ChatList 영역입니다.</h1>
        <div class="chatRoomList-main">
            <div class="listMenuContainer">
                <div class="listMenu-item"><i class="fa-solid fa-magnifying-glass" style="padding-right: 10px"></i>검색</div>
                <div class="listMenu-item">내 채팅방</div>
                <div class="listMenu-item" style="width: 100px; color:white; background-color: #466288; cursor:auto">전체</div>
            </div>

            <br><br><br>

            <div id="listSwitchContainer">
                <button type="button" class="listSwitch-btn" id="toList-btn" onclick="switchToListView();">
                    <i class="fa-solid fa-list"></i><span>목록형</span>
                </button>
                <button type="button" class="listSwitch-btn" id="toCard-btn" onclick="switchToCardView();">
                    <i class="fa-solid fa-table-cells"></i><span>카드형</span>
                </button>
            </div>

            <div id="position-box">
<!--                리스트형 레이아웃-->

                    <div class="chatRoomList-container" id="toList-container">
                        <div th:if="${chatRoomList != null}" th:each="chatRoom : ${chatRoomList}" class="chatRoom-item list-item fade-out">
                            <div class="itemBtnFlexContainer">
                                <div class="item-flex-container">

                                    <div class="flex-item-memberProfile" th:each="memberProfile : ${profileList}">
                                        <th:block  th:if="${memberProfile.memberId != chatRoom.roomWriter}">
                                            <img alt="프로필" src="/img/chat/defaultProfile2.png" style="width: 100%; height: 100%; border-radius: 30%;">
                                        </th:block>
                                        <th:block  th:if="${memberProfile.memberId == chatRoom.roomWriter}">
                                            <img th:src="@{|${memberProfile.filePath}${memberProfile.fileRename}|}" alt="프로필" style="width: 100%; height: 100%; border-radius: 30%;">
                                        </th:block>
                                    </div>
                                    <div class="flex-item-chatInfoBox">
                                        <div class="chatRoomName" th:text="${chatRoom.roomName}"></div>

                                        <div class="chatTagList">태그 :
                                            <span th:each="tag : ${tagList}" th:if="${tag.roomNo == chatRoom.roomNo}" th:text="'#'+${tag.tagName}+' '"></span>
                                        </div>
                                        <div style="display: flex">
                                            <div style="margin-right: 50px">참여인원: 00명 참여중</div>
                                            <div th:text="${chatRoom.title}+' ('+${chatRoom.cinemaAddress}+' / '+${chatRoom.cinemaName}+')'"></div>
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <div class="joinBtn">참여</div>
                                </div>
                            </div>

                            <!--                        <div>방장 이미지</div>-->

                            <!--                        <div th:text="'채팅방 생성 날짜 : '+${chatRoom.roomDate}"></div>-->
                            <!--                        <div>채팅방 최근채팅내용</div>-->

                            <!--                        <div th:text="'영화이름 : '+${chatRoom.movieNo}"></div>-->
                            <!--                        <div th:text="'지역 : '+${chatRoom.cinemaLocationCode}"></div>-->
                            <!--                        <div th:text="'극장 : '+${chatRoom.cinemaNo}"></div>-->
                        </div>


                    </div>


                    <!--                카드형 레이아웃-->
                    <div class="chatRoomList-container" id="toCard-container">
                        <div th:if="${chatRoomList != null}" th:each="chatRoom : ${chatRoomList}" class="chatRoom-item card-item fade-out">
                            <div class="card-mouseover">
                                <div class="card-mouseover-text" th:if="${chatRoom.roomCategory == 'reservation'}" th:text="'모집방'"></div>
                                <div class="card-mouseover-text" th:if="${chatRoom.roomCategory == 'talk'}" th:text="'소통방'"></div>
                                <div class="card-mouseover-text joinBtn2">참여하기</div>
                            </div>
                            <div th:style="'width:100%; height: 400px; background-image: url('+${chatRoom.posterUrl}+'); background-position: center; background-size: cover; border-radius:20px;'">
                            </div>

                            <div class="toCard-item-info">
                                <div class="itemCard-title" th:text="'< '+${chatRoom.title}+' >'"></div>
                                <div style="font-size: 25px; font-weight:bold" th:text="${#strings.length(chatRoom.roomName) > 15 ? chatRoom.roomName.substring(0, 15) + ' . . .' : chatRoom.roomName}"></div>

                                <div class="itemCard-recentContent" >채팅방 최근채팅내용</div>

                                <div>
                                    <span th:each="tag : ${tagList}" th:if="${tag.roomNo == chatRoom.roomNo}" th:text="'#'+${tag.tagName}+' '"></span>
                                </div>

                                <div style="">00명 참여중</div>
                                <div th:text="${chatRoom.cinemaAddress}+' / '+${chatRoom.cinemaName}"></div>
                                <th:block th:each="rTime : ${relativeTimeList}">
                                    <div class="itemCard-roomDate" th:if="${chatRoom.roomDate == rTime.roomDate}" th:text="'개설일 : '+${rTime.relativeTime}"></div>
                                </th:block>


                            </div>


                        </div>
                    </div>


            </div>


            <div>
                <div class="paginationBox" th:unless="${#lists.isEmpty(chatRoomList)}">
                    <div>
                        <a th:if="${pn.currentPage != 1}"  href="javascript:void(0)" th:text="처음" th:onclick="navigatePage(1)"></a>
                        <a th:if="${pn.getStartNavi() != 1}"  href="javascript:void(0)" th:text="이전" th:onclick="navigatePage([[${pn.prevPage}]])"></a>

                        <span th:each="p : ${#numbers.sequence(pn.startNavi, pn.endNavi)}">
                            <span th:if="${p == pn.currentPage}">
                                <span id="currentPageId">
                                    [[${p}]]
                                </span>
                            </span>
                            <span th:if="${p != pn.currentPage}">
                                <a href="javascript:void(0)" th:text="${p}" th:onclick="navigatePage([[${p}]]);"></a>
                            </span>
                        </span>

                        <a th:if="${pn.getEndNavi() != pn.MaxPage}"  href="javascript:void(0)" th:text="다음" th:onclick="navigatePage([[${pn.nextPage}]])"></a>
                        <a th:if="${pn.currentPage != pn.maxPage}"  href="javascript:void(0)" th:text="마지막" th:onclick="navigatePage([[${pn.maxPage}]])"></a>

                    </div>
                </div>
            </div>


        </div>



        [[${pn}]]

        <br><br><br>
        <div>최근참여많은방을 추천해요</div>
        <div>이런주제는 어때요?</div>
        <div>태그들</div>
        <div>최근 대화 많은 방</div>


    </body>
</html>