<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title>선물하기</title>
    <link rel="stylesheet" href="css/store/gift.css">
</head>
<body>
    <div class="container">
        <h1>선물하기</h1>

        <div class="progress-bar">
            <span class="step active">장바구니</span>
            <span class="step active">선물정보 입력</span>
            <span class="step">결제하기</span>
            <span class="step">결제완료</span>
        </div>

        <form th:action="@{/store/purchase/initiate}" method="post" th:object="${gift}">
            <input type="hidden" th:field="*{giftNo}" />

            <section class="product-info">
                <h2>구매 상품 정보</h2>
                    <div class="product-item" th:each="item, itemStat : *{giftItems}">
                        <input type="hidden" th:field="*{giftItems[__${itemStat.index}__].productNo}" />
                        <input type="hidden" th:field="*{giftItems[__${itemStat.index}__].quantity}" />
                    <div class ="product-image">
                        <img th:if="${item.product != null and item.product.imageUrl != null}"
                             th:src="${item.product.imageUrl}"
                             th:alt="${item.product != null ? item.product.productName : '상품 이미지'}" />
                    </div>
                        <div class="product-details">
                            <h3 class="product-name" th:text="${item.product != null ? item.product.productName : '상품명 없음'}">상품명</h3>
                            <p>가격: <span th:text="${#numbers.formatDecimal(item.price, 0, 'COMMA', 0, 'POINT')} + '원'"></span></p>
                            <p>수량: <span th:text="${item.quantity}"></span></p>
                        </div>
                    </div>
    </div>

    <div class="section gift-message">
        <h2>선물 메시지 입력</h2>
        <select id="messageType" onchange="toggleMessageInput()">
            <option value="preset">메시지 선택</option>
            <option value="custom">직접 입력하기</option>
        </select>
        <textarea th:field="*{message}" id="giftMessage"></textarea>
    </div>

    <div class="section recipient-info">
        <h2>선물 받는 분 정보</h2>
        <input type="text" th:field="*{recipientName}" placeholder="이름">
        <input type="text" th:field="*{recipientPhone}" placeholder="전화번호">
        <button type="button" onclick="verifyRecipient()">확인</button>
    </div>

    <div class="section price-summary">
        <h2>결제 금액</h2>
        <div class="price-details">
            <p>총 상품 금액: <span id="total-price" th:text="${#numbers.formatDecimal(giftForm.totalAmount, 0, 'COMMA', 0, 'POINT')} + '원'"></span></p>
            <p>총 할인 금액: <span id="discount-amount" th:text="${#numbers.formatDecimal(giftForm.totalDiscountAmount, 0, 'COMMA', 0, 'POINT')} + '원'"></span></p>
            <p>총 결제 예정금액: <span id="final-price" th:text="${#numbers.formatDecimal(giftForm.finalAmount, 0, 'COMMA', 0, 'POINT')} + '원'"></span></p>
        </div>
    </div>

    <div class="action-buttons">
        <button type="button" onclick="goToPreviousStep()">이전단계</button>
        <button type="submit">결제하기</button>
    </div>
    </form>
    </div>


    <script src="/js/store/gift.js"></script>
</body>
</html>